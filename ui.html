<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Renumber Plugin</title>
    <style>
      :root {
        --font-family-default: 'Inter', ui-sans-serif, system-ui, -apple-system,
          'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial',
          'Noto Sans', sans-serif, 'SFProLocalRange';
        --font-weight-default: 450;

        --text-body-medium-letter-spacing: 0.00344rem;

        --text-body-medium-line-height: 1rem;

        --text-body-medium-font-family: var(--font-family-default);
        --text-body-medium-font-size: 0.6875rem;
        --text-body-medium-font-weight: var(--font-weight-default);
        --spacer-4: 1.5rem;

        --btn-height: 1.5rem;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: var(--figma-color-bg);
        color: var(--figma-color-text);
        font-family: 'Inter', sans-serif;
        font-size: 16px;
        font-weight: 400;
      }
      .content {
        display: flex;
        flex-direction: column;
        height: 100%;
        justify-content: center;
        align-items: center;
        padding: 1rem;
      }

      .spacer-4 {
        height: 1rem;
      }

      .form-group {
        width: 100%;
        margin-bottom: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .button-group {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      h2 {
        font-family: var(--font-family-default);
        font-size: 1.25rem;
        line-height: auto;
      }

      button {
        width: 100%;
        height: var(--btn-height);
        font: inherit;
        font-size: var(--text-body-medium-font-size);
        font-weight: 400;
        color: var(--figma-color-text);
        text-align: center;
        line-height: auto;
        background-color: var(--figma-color-bg);
        display: block;
        padding: 0.25rem 0.5rem;
        background-color: transparent;
        box-sizing: border-box;
        border: 1px solid #d4d4d4;
        border-radius: 3px;
        outline: none;
        cursor: pointer;
      }

      label {
        font-size: var(--text-body-medium-font-size);
        font-weight: 600;
      }

      input[type='text'] {
        font-family: var(--text-body-medium-font-family);
        font-size: var(--text-body-medium-font-size);
        font-weight: var(--text-body-medium-font-weight);
        letter-spacing: var(--text-body-medium-letter-spacing);
        line-height: var(--text-body-medium-line-height);
        color: var(--figma-color-text);

        width: 100%;
        background-color: var(--figma-color-bg-secondary);

        height: var(--spacer-4);
        box-sizing: border-box;
        padding: 0 2px 0 4px;
        border: 1px solid transparent;
        border-radius: 3px;
      }

      input[type='text']:focus {
        border-color: #30c2ff;
        box-shadow: inset 0 0 0 1px #30c2ff;
        outline: none;
      }

      input[type='checkbox'] {
        width: 14px;
        height: 14px;
        border: 1px solid #d4d4d4;
        border-radius: 3px;
        box-sizing: border-box;
        background-color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="content">
      <h2>Config</h2>
      <div class="form-group">
        <label for="instance_name">Instance name</label>
        <input
          type="text"
          name="instance_name"
          id="instance_name"
          placeholder="My-Instance-Name"
          autocomplete="on"
        />
      </div>
      <div class="form-group">
        <label for="text_field">Text field name</label>
        <input
          type="text"
          name="text_field"
          id="text_field"
          placeholder="My-TextField-Name"
          autocomplete="on"
        />
      </div>
      <div class="spacer-4"></div>
      <h2>Actions</h2>
      <div class="button-group">
        <button class="btn fillMaxWidth" id="select_instances">
          Select Instances
        </button>
        <button class="btn fillMaxWidth" id="run">Renumber Instances</button>
      </div>
    </div>

    <script>
      const instanceNameField = document.getElementById('instance_name')
      const textField = document.getElementById('text_field')
      const selectInstancesOf = document.getElementById('select_instances')

      window.onload = () => {
        parent.postMessage({ pluginMessage: { type: 'loadData' } }, '*')
      }

      window.onmessage = (event) => {
        const msg = event.data.pluginMessage
        if (!msg) return

        if (msg.type === 'loadedData') {
          const savedData = msg.data || {}
          if (savedData.instanceName) {
            instanceNameField.value = savedData.instanceName
          }
          if (savedData.textField) {
            textField.value = savedData.textField
          }
        } else if (msg.type === 'error') {
          alert(msg.value)
        }
      }

      function saveData() {
        const data = {
          instanceName: instanceNameField.value,
          textField: textField.value,
        }
        parent.postMessage({ pluginMessage: { type: 'saveData', data } }, '*')

        parent.postMessage(
          { pluginMessage: { type: 'instanceName', value: data.instanceName } },
          '*'
        )
        parent.postMessage(
          { pluginMessage: { type: 'textField', value: data.textField } },
          '*'
        )
      }

      instanceNameField.addEventListener('change', saveData)
      textField.addEventListener('change', saveData)

      selectInstancesOf.addEventListener('click', () => {
        parent.postMessage(
          {
            pluginMessage: {
              type: 'selectInstances',
            },
          },
          '*'
        )
      })

      document.getElementById('run').onclick = () => {
        if (!instanceNameField.value.trim() || !textField.value.trim()) {
          parent.postMessage(
            {
              pluginMessage: {
                type: 'error',
                value: 'The fields must be filled',
              },
            },
            '*'
          )
          return
        }
        parent.postMessage({ pluginMessage: { type: 'renumber' } }, '*')
      }
    </script>
  </body>
</html>
